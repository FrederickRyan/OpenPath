<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile | OpenPath</title>
  <link rel="icon" type="image/png" href="assets/OP_Logo.png">
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    body {
      margin: 0 !important;
      padding: 0;
      margin-top: 1rem;
      padding-top: 4rem;
    }
    .profile-hero {
      background-color: #043873;
      color: white;
      padding: 0 2rem 4rem 2rem;  /* no top padding */
      position: relative;
    }

    .profile-hero .container {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .profile-info {
      flex: 1 1 300px;
    }

    .profile-info h1 {
      font-size: 2.5rem;
      font-weight: bold;
    }

    .profile-info h2 {
      font-size: 1.25rem;
      font-weight: bold;
      margin-top: 0.5rem;
    }

    .profile-info p {
      margin: 0.5rem 0;
    }

    .connect-btn {
      background-color: #62aaff;
      padding: 0.5rem 1.5rem;
      color: #fff;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }

    .connect-btn:hover {
      background-color: #1a78d2;
    }

    .edit-btn-banner {
      position: absolute;
      top: 2rem;
      right: 2rem;
      background-color: #fcd34d;
      color: black;
      font-weight: bold;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .edit-btn-banner:hover {
      background-color: #fbbf24;
    }

    .profile-img {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      object-fit: cover;
    }

    .change-photo {
      display: none;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      text-align: center;
    }

    .editing .change-photo {
      display: block;
    }

    .change-photo label {
      color: #fcd34d;
      text-decoration: underline;
      cursor: pointer;
    }

    .section {
      padding: 3rem 1rem;
    }

    .section.white {
      background: #fff;
      color: #000;
    }

    .section.blue {
      background: #043873;
      color: white;
    }

    .section h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .section ul {
      list-style-type: disc;
      padding-left: 2rem;
    }

    .section ul li {
      margin-bottom: 0.5rem;
    }

    .bold {
      font-weight: bold;
    }

    .editing-indicator {
      position: absolute;
      top: 1rem;
      left: 2rem;
      background-color: #fbbf24;
      color: black;
      font-weight: bold;
      padding: 0.4rem 1rem;
      border-radius: 6px;
    }

    .editable {
      padding: 0.25rem 0.5rem;
      border: 2px dashed transparent;
      border-radius: 6px;
      min-height: 1.5rem;
    }

    .editing .editable-black {
      background-color: #111;
      color: #fff;
      border-color: #333;
    }

    .editing .editable-yellow {
      background-color: #fef08a;
      color: #000;
      border-color: #fcd34d;
    }

    @media (max-width: 768px) {
      .profile-hero .container { flex-direction: column; text-align: center; }
      .profile-img { width: 200px; height: 200px; }
      .edit-btn-banner { top: 1rem; right: 1rem; padding: 0.4rem 0.75rem; }
    }
  </style>
</head>
<body>

  <header>
    <div class="container navbar">
      <a href="index.html" class="logo js-transition">
        <img src="assets/OP_Logo.png" alt="OpenPath Logo" class="logo-icon">
        OpenPath
      </a>

      <div class="burger" id="burger">
        <span></span><span></span><span></span>
      </div>
      <nav class="nav-links" id="navLinks">
        <a href="index.html" class="js-transition">Home</a>
        <!-- “Login” and “Try OpenPath free” will be hidden if the user is logged in -->
        <a id="signupLink" href="signup.html" class="btn js-transition">Try OpenPath free</a>
        <div id="profileContainer" style="display: none;"></div>
      </nav>
    </div>
  </header>

  <section class="profile-hero" id="profileHero">
    <div id="editingIndicator" class="editing-indicator" style="display: none;">Editing Mode</div>
    <button class="edit-btn-banner" onclick="toggleEdit()">Edit Profile</button>
    <div class="container">
      <div class="profile-info">
        <h1 id="name" class="editable editable-black" contenteditable="false">John Doe</h1>
        <h2 id="title" class="editable editable-black" contenteditable="false">Current job</h2>
        <p id="location" class="editable editable-black" contenteditable="false">Location</p>
        <p id="phone" class="editable editable-black" contenteditable="false">Phone number</p>
        <p id="email" class="editable editable-black" contenteditable="false">Email</p>
        <a href="https://id.linkedin.com/" class="connect-btn">Connect</a>
      </div>
      <div style="text-align: center;">
        <!-- PROFILE IMAGE -->
        <img id="profileImg" src="assets/Default_profile.png" alt="Profile" class="profile-img" />
        <div class="change-photo">
          <input type="file" id="imageInput" accept="image/*" style="display: none;" />
          <label for="imageInput">Change Picture</label>
        </div>
      </div>
    </div>
  </section>

  <section class="section white">
    <div class="container">
      <h2>Experience</h2>
      <ul>
        <li class="editable editable-yellow" contenteditable="false">(Experience)</li>
        <li class="editable editable-yellow" contenteditable="false">(Experience)</li>
        <li class="editable editable-yellow" contenteditable="false">(Experience)</li>
        <li class="editable editable-yellow" contenteditable="false">(Experience)</li>
      </ul>

      <h2>Education</h2>
      <p class="editable editable-yellow" contenteditable="false">
        University: (e.g. State University)<br>
        Bachelor: (e.g. B.S. in Computer Science)<br>
        Date: (e.g. 2020–2024)<br>
        GPA: (e.g. 3.8)<br>
        Activities: (e.g. Chess Club, Volunteer)
      </p>
    </div>
  </section>

  <section class="section blue">
    <div class="container">
      <h2>Soft Skills</h2>
      <ul>
        <li class="editable editable-black" contenteditable="false">(e.g. Teamwork, Problem Solving)</li>
        <li class="editable editable-black" contenteditable="false">…</li>
        <li class="editable editable-black" contenteditable="false">…</li>
        <li class="editable editable-black" contenteditable="false">…</li>
      </ul>

      <h2 style="margin-top: 2rem;">Technical Skills</h2>
      <ul>
        <li class="editable editable-black" contenteditable="false">(e.g. C++, SQL)</li>
        <li class="editable editable-black" contenteditable="false">…</li>
        <li class="editable editable-black" contenteditable="false">…</li>
        <li class="editable editable-black" contenteditable="false">…</li>
      </ul>
    </div>
  </section>

  <section class="section white">
    <div class="container">
      <h2>Open to</h2>
      <ul>
        <li class="editable editable-yellow" contenteditable="false">(e.g. Full-time, Remote, Internship)</li>
        <li class="editable editable-yellow" contenteditable="false">…</li>
        <li class="editable editable-yellow" contenteditable="false">…</li>
      </ul>
    </div>
  </section>

  <!-- NEW “Special Needs” SECTION -->
  <section class="section white">
    <div class="container">
      <h2>Special Needs</h2>
      <ul>
        <li class="editable editable-yellow" contenteditable="false">(e.g. Mobility Assistance)</li>
        <li class="editable editable-yellow" contenteditable="false">(e.g. Hearing Support)</li>
        <li class="editable editable-yellow" contenteditable="false">(e.g. Visual Aid)</li>
        <li class="editable editable-yellow" contenteditable="false">(e.g. Other)</li>
      </ul>
    </div>
  </section>
  <footer>
    <div class="container">
      <p>&copy; 2025 OpenPath. All rights reserved.</p>
    </div>
  </footer>

  <!-- LOGIN REQUIRED MODAL (for “Apply Now”) -->
  <div id="loginModalOverlay" class="modal-overlay">
    <div class="modal">
      <h3>Login Required</h3>
      <p>Please log in to access your profile or apply for jobs.</p>
      <button id="closeModal" class="btn">Close</button>
    </div>
  </div>
<!-- 1) Firebase Realtime-DB + Storage SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- 2) Init Firebase -->
  <script>
    const firebaseConfig = {
      apiKey: "…",
      authDomain: "openpath-56a25.firebaseapp.com",
      databaseURL:"https://openpath-56a25-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId:"openpath-56a25",
      storageBucket:"openpath-56a25.appspot.com",
      messagingSenderId:"720563865978",
      appId:"1:720563865978:web:…"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage  = firebase.storage();
  </script>

  <!-- MAIN SCRIPT: nav, animations, signup/login logic, profile logic, etc. -->
  <script>
    
    let isEditing = false;
    

    function toggleEdit() {
      isEditing = !isEditing;
      const editableFields = document.querySelectorAll(".editable");
      editableFields.forEach(el => el.contentEditable = isEditing);
      document.body.classList.toggle("editing", isEditing);
      document.getElementById("editingIndicator").style.display = isEditing ? "block" : "none";
      document.querySelector(".edit-btn-banner").textContent = isEditing ? "Save Profile" : "Edit Profile";

      if (!isEditing) {
        // Exiting edit mode → save everything
        saveProfileData();
        
      }
    }

    

    // ─── Profile persistence logic ─────────────────────────────────────────
    async function saveProfileData() {
    const updated = {
      fullName:    document.getElementById('name').innerText.trim(),
      email:       document.getElementById('email').innerText.trim().toLowerCase(),
      currentJob:  document.getElementById('title').innerText.trim(),
      location:    document.getElementById('location').innerText.trim(),
      phoneNumber: document.getElementById('phone').innerText.trim(),
      experience:  Array.from(document.querySelectorAll(".section.white:nth-of-type(2) ul li.editable")).map(li=>li.innerText.trim()),
      education:   (() => {
        const lines = document.querySelector(".section.white:nth-of-type(2) p.editable").innerText.split("\n");
        return {
          university: lines[0].replace(/^University:\s*/,''),
          bachelor:   lines[1].replace(/^Bachelor:\s*/,''),
          date:       lines[2].replace(/^Date:\s*/,''),
          gpa:        lines[3].replace(/^GPA:\s*/,''),
          activities: lines[4].replace(/^Activities:\s*/,'')
        };
      })(),
      softSkills:  Array.from(document.querySelectorAll(".section.blue ul:first-of-type li.editable")).map(li=>li.innerText.trim()),
      techSkills:  Array.from(document.querySelectorAll(".section.blue ul:nth-of-type(2) li.editable")).map(li=>li.innerText.trim()),
      openTo:      Array.from(document.querySelectorAll(".section.white:nth-of-type(4) ul li.editable")).map(li=>li.innerText.trim()),
      specialNeeds:Array.from(document.querySelectorAll(".section.white:nth-of-type(5) ul li.editable")).map(li=>li.innerText.trim()),
      profileImage: lastUploadedURL || originalData.profileImage,
      password:    originalData.password
    };

    try {
      await userRef.update(updated);
      // 1A) Update localStorage.currentUser.fullName
      const cu = JSON.parse(localStorage.getItem('currentUser') || '{}');
      cu.fullName = updated.fullName;
      localStorage.setItem('currentUser', JSON.stringify(cu));

      const banner = document.createElement("div");
      banner.innerText = "Profile saved!";
      banner.style.position = "fixed";
      banner.style.top = "1rem";
      banner.style.left = "50%";
      banner.style.transform = "translateX(-50%)";
      banner.style.background = "#62aaff";
      banner.style.color = "#fff";
      banner.style.padding = "0.75rem 1.5rem";
      banner.style.borderRadius = "6px";
      banner.style.zIndex = "3000";
      document.body.appendChild(banner);
      setTimeout(() => banner.remove(), 2000);
    } catch (err) {
      console.error(err);
      alert('Save failed. Please try again.');
    }
  }

    // Ctrl+Enter or Cmd+Enter also saves & exits edit mode
    document.addEventListener("keydown", e => {
      if (!isEditing) return;
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        toggleEdit();
      }
    });

    let userRef, originalData, lastUploadedURL;

  document.addEventListener('DOMContentLoaded', async () => {
    const cu = JSON.parse(localStorage.getItem('currentUser') || 'null');
    if (!cu?.id) return window.location.href = 'login.html';

    // point at /users/{id}
    userRef = database.ref('users/' + cu.id);
    const snap = await userRef.once('value');
    originalData = snap.val() || {};

    // populate text fields
    ['fullName','email','currentJob','location','phoneNumber','profileImage']
      .forEach(key => {
        const el = document.getElementById(
          key === 'fullName'   ? 'name' :
          key === 'currentJob' ? 'title' :
          key === 'phoneNumber'? 'phone' : key
        );
        if (el) el.innerText = originalData[key] || '';
      });
      const ed = originalData.education || {};
      const anyEdu = [ed.university, ed.bachelor, ed.date, ed.gpa, ed.activities]
                      .some(v => v && v.trim() !== '');
      if (anyEdu) {
        const eduEl = document.querySelector(".section.white:nth-of-type(2) p.editable");
        eduEl.innerHTML =
          `University: ${ed.university || ''}<br>` +
          `Bachelor:   ${ed.bachelor   || ''}<br>` +
          `Date:       ${ed.date       || ''}<br>` +
          `GPA:        ${ed.gpa        || ''}<br>` +
          `Activities: ${ed.activities || ''}`;
      }

    document.getElementById('profileImg').src =
  originalData.profileImage || 'assets/Default_profile.png';

    // arrays: experience, softSkills, techSkills, openTo, specialNeeds
    const mappings = [
      ['experience', ".section.white:nth-of-type(2) ul li.editable"],
      ['softSkills',  ".section.blue ul:first-of-type li.editable"],
      ['techSkills',  ".section.blue ul:nth-of-type(2) li.editable"],
      ['openTo',      ".section.white:nth-of-type(4) ul li.editable"],
      ['specialNeeds',".section.white:nth-of-type(5) ul li.editable"]
    ];
    mappings.forEach(([key, sel]) => {
      (originalData[key]||[]).forEach((txt,i) => {
        const els = document.querySelectorAll(sel);
        if (els[i]) els[i].innerText = txt;
      });
    });

    // image‐upload picker
      // ─── Data-URL image uploader ─────────────────────────────────
  const input = document.getElementById('imageInput');
  const img   = document.getElementById('profileImg');

  input.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) {
      return alert('Please pick an image file.');
    }

    const reader = new FileReader();
    reader.onloadend = () => {
      const dataURL = reader.result;   // base64 string
      img.src       = dataURL;         // preview immediately

      // save that string into your RTDB:
      userRef.update({ profileImage: dataURL })
        .then(() => console.log('✔ profileImage saved as Data-URL'))
        .catch(err => {
          console.error('DB write failed:', err);
          alert('Could not save image. See console.');
        });
    };
    reader.readAsDataURL(file);
  });
  // ───────────────────────────────────────────────────────────────

  });
    // ─── END Profile persistence logic ────────────────────────────────────────
  </script>


  <!-- EXTERNAL SCRIPT (nav, animations, signup/login logic, etc.) -->
  <script src="js/script.js"></script>
</body>
</html>
